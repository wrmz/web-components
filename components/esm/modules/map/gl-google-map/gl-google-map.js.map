{"version":3,"file":"gl-google-map.js","sources":["../../../../../../src/modules/map/gl-google-map/gl-google-map.js"],"sourcesContent":["/*global google*/\nimport { registerComponents } from '../../common/register-components.js';\nimport { GlGoogleMarker } from '../gl-google-marker/gl-google-marker.js';\n\n/**\n * @injectHTML\n */\nexport class GlGoogleMap extends HTMLElement {\n    static get observedAttributes() {\n        return [\n            'key',\n            'latitude',\n            'longitude',\n            'overlay',\n        ];\n    }\n\n    static getNormalizedCoord(coord, zoom) {\n        const y = coord.y;\n        let x = coord.x;\n        const tileRange = 1 << zoom;\n\n        if (y < 0 || y >= tileRange) {\n            return null;\n        }\n\n        if (x < 0 || x >= tileRange) {\n            x = ((x % tileRange) + tileRange) % tileRange;\n        }\n\n        return { x, y };\n    }\n\n    constructor() {\n        super();\n\n        registerComponents(GlGoogleMarker);\n\n        this.key = '';\n        this._id = crypto.randomUUID ? crypto.randomUUID().split('-').pop() : Math.round(Math.random() * 9999);\n        this._overlayElems = [...this.querySelectorAll('gl-google-overlay')];\n        this._markerElems = [...this.querySelectorAll('gl-google-marker')];\n        this._markers = [];\n        this.apiLoadedCBName = `gl_cb_${this._id}`;\n        this.map = undefined;\n        this.overlayLayer = undefined;\n        this.elem = this.shadowRoot.querySelector('.map');\n        this.elem.setAttribute('id', `map_${this._id}`);\n\n        this.generateMarker = this.generateMarker.bind(this);\n    }\n\n    get latitude() {\n        const latitude = parseFloat(this.hasAttribute('latitude') ? this.getAttribute('latitude') : '0');\n        return  isNaN(latitude) ? 0 : latitude;\n    }\n\n    get longitude() {\n        const longitude = parseFloat(this.hasAttribute('longitude') ? this.getAttribute('longitude') : '0');\n        return  isNaN(longitude) ? 0 : longitude;\n    }\n\n    get overlay() {\n        return this.getAttribute('overlay');\n    }\n\n    get markerElems() {\n        return [...this._markerElems];\n    }\n\n    get markers() {\n        return this._markers;\n    }\n\n    set markers(markers) {\n        if (this.map && google && google.maps) {\n            this._markers = markers.map(this.generateMarker);\n        } else {\n            this._markers = [];\n        }\n    }\n\n    handleApiLoaded() {\n        this.map = new google.maps.Map(this.elem, {\n            center: { lat: this.latitude, lng: this.longitude },\n            zoom: 8\n        });\n        this.generateOverlay();\n        setTimeout(() => {\n            this.markers = this.markerElems;\n            console.log(this.markerElems);\n            console.log(this.markers);\n        }, 100);\n    }\n\n    generateOverlay() {\n        this.overlayLayer = new google.maps.KmlLayer({\n            url: this.overlay,\n            map: this.map\n        });\n    }\n\n    generateMarker(marker) {\n        const mapMarker = new google.maps.Marker({\n            map: this.map,\n            position: { lat: marker.latitude, lng: marker.longitude },\n            draggable: true,\n        });\n\n        mapMarker.addListener('dragend', (event) => {\n            const dragendEvent = new CustomEvent('dragend', {\n                detail: {\n                    map: this.map,\n                    marker: mapMarker,\n                    position: {\n                        latitude: event.latLng.lat(),\n                        longitude: event.latLng.lng()\n                    }\n                }\n            });\n            this.dispatchEvent(dragendEvent);\n            console.log('lat:', event.latLng.lat(), 'lng:', event.latLng.lng());\n        });\n\n        return mapMarker;\n    }\n\n    loadGoogleMapsApi() {\n        const endpoint = 'https://maps.googleapis.com/maps/api/js';\n        const script = document.createElement('script');\n        script.id = `map_script_${this._id}`;\n        script.type = 'text/javascript';\n        script.src = `${endpoint}?key=${this.key}&callback=${this.apiLoadedCBName}&v=weekly`;\n        script.defer = true;\n        script.async = true;\n        window[this.apiLoadedCBName] = this.handleApiLoaded.bind(this);\n        document.head.appendChild(script);\n    }\n\n    /**\n     * Fires when the component is connected to the DOM\n     */\n    connectedCallback() {\n        this._markerElems = this.querySelectorAll('gl-google-marker');\n    }\n\n    adoptedCallback() {\n        this._markerElems = this.querySelectorAll('gl-google-marker');\n    }\n\n    /**\n     * Handles changes to the component attributes\n     * @param {String} name\n     * @param {String} oldValue\n     * @param {String} newValue\n     */\n    attributeChangedCallback(name, oldValue, newValue) {\n        if (name === 'key' && newValue) {\n            this.key = newValue;\n            this.removeAttribute('key');\n            this.loadGoogleMapsApi();\n        }\n    }\n}\n\nif (!window.customElements.get('gl-google-map')) {\n    window.customElements.define('gl-google-map', GlGoogleMap);\n}\n"],"names":[],"mappings":"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"}