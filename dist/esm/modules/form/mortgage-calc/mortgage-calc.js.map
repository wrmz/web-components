{"version":3,"file":"mortgage-calc.js","sources":["../../../../../src/modules/form/mortgage-calc/mortgage-calc.js"],"sourcesContent":["import { registerComponents } from '../../common/register-components.js';\nimport { MortgageCalcInput } from '../mortgage-calc-input/mortgage-calc-input.js';\nimport { RadioGroup } from '../radio-group/radio-group.js';\nimport { ChartDonut } from '../../chart/donut/chart-donut.js';\n\n/**\n * @injectHTML\n */\nexport class MortgageCalc extends HTMLElement {\n    static get observedAttributes() {\n        return [\n            'price',\n            'downpayment',\n            'interest',\n            'taxes',\n            'term',\n            'pmi',\n            'hoa',\n            'monthly-payment',\n            'colors',\n        ];\n    }\n\n    constructor() {\n        super();\n\n        registerComponents(MortgageCalcInput, RadioGroup, ChartDonut);\n\n        this.chartElement = undefined;\n\n        this.elements = {\n            price: this.shadowRoot.querySelector('mortgage-calc-input[name=\"price\"]'),\n            downpayment: this.shadowRoot.querySelector('mortgage-calc-input[name=\"downpayment\"]'),\n            interest: this.shadowRoot.querySelector('mortgage-calc-input[name=\"interest\"]'),\n            taxes: this.shadowRoot.querySelector('mortgage-calc-input[name=\"taxes\"]'),\n            term: this.shadowRoot.querySelector('radio-group[name=\"term\"]'),\n            hoa: this.shadowRoot.querySelector('mortgage-calc-input[name=\"hoa\"]'),\n        };\n\n        this.output = {\n            principal: this.shadowRoot.querySelector('#outputPrincipal'), // will include interest\n            taxes: this.shadowRoot.querySelector('#outputTaxes'),\n            fees: this.shadowRoot.querySelector('#outputFees'),\n            perMonth: this.shadowRoot.querySelector('#outputPerMonth'),\n        };\n\n        this.addEventListener('input', this.handleInput, false);\n    }\n\n    get colors() {\n        let colors = this.getAttribute('colors') || '';\n        colors = colors.replace(/'/g, '\"');\n        return colors ? JSON.parse(colors) : [];\n    }\n\n    get currencyFormat() {\n        return new Intl.NumberFormat('en-US', {\n            style: 'currency',\n            currency: 'USD',\n            minimumFractionDigits: 0,\n            maximumFractionDigits: 0,\n        }).format;\n    }\n\n    get price() { return this.elements ? this.elements.price.numeric : 0; }\n    set price(v) { this.elements.price.value = v; }\n\n    get downpayment() { return this.elements ? this.elements.downpayment.numeric : 0; }\n    set downpayment(v) { this.elements.downpayment.value = v; }\n\n    get interest() { return this.elements ? this.elements.interest.numeric : 0; }\n    set interest(v) { this.elements.interest.value = v; }\n\n    get taxes() { return this.elements ? this.elements.taxes.numeric : 0; }\n    set taxes(v) { this.elements.taxes.value = v;}\n\n    get hoa() { return this.elements ? this.elements.hoa.numeric : 0; }\n    set hoa(v) { this.elements.hoa.value = v; }\n\n    get term() { return this.elements ? this.elements.term.numeric : 0; }\n    set term(v) { this.elements.term.value = v; }\n\n    get pmi() { return this.getAttribute('pmi') || ''; }\n\n    get insurance() { return this.getAttribute('insurance') || ''; }\n\n    /**\n     * The mortgage principal is the initial loan amount.\n     * It's the price minus the downpayment you make.\n     * If a home is $500,000 and you put down $100,000,\n     * you'll need to borrow $400,000 from the bank.\n     */\n    get mortgagePrincipal() { return this.price - this.downpayment; }\n\n    /**\n     * The interest rate percentage is divided by 12 (months in a year)\n     * to find the monthly interest rate.\n     * If the annual interest rate is 4%, the monthly interest rate is 0.33%\n     * or 0.0033.\n     */\n    get monthlyInterestRate() { return this.interest / 100 / 12; }\n\n\n    /**\n     * For a fixed-rate mortgage, the term is often 30 or 15 years.\n     * The number of payments is the number of years multiplied by\n     * 12 (months in a year). 30 years would be 360 monthly payments.\n     */\n    get numberOfPayments() { return this.term * 12; }\n\n\n    /**\n     * Monthly principal and interest is calculated against the loan principal\n     * and considers the monthly interest rate and total months in the loan term chosen\n     * @returns {Number}\n     */\n    get monthlyPrincipalAndInterest() {\n        const isCalculable = this.mortgagePrincipal && this.monthlyInterestRate;\n        return isCalculable\n            ? (this.mortgagePrincipal / ((1 - Math.pow(1 + this.monthlyInterestRate, -this.numberOfPayments)) / this.monthlyInterestRate))\n            : 0;\n    }\n\n\n    /**\n     * The monthly mortgage principal divided by the total number\n     * of payments\n     * @returns {Number}\n     */\n    get monthlyMortgagePrincipal() {\n        const monthlyMortgagePrincipal = this.monthlyPrincipalAndInterest - this.monthlyInterestCost;\n        return monthlyMortgagePrincipal;\n    }\n\n    /**\n     * The interest cost is the mortgage principal multiplied by the monthly interest rate\n     * @returns {Number}\n     */\n    get monthlyInterestCost() {\n        const interestCost = this.mortgagePrincipal * this.monthlyInterestRate;\n        return interestCost;\n    }\n\n    /**\n     * Private mortgage insurance (PMI) is required if you put\n     * down less than 20% of the purchase price with a conventional mortgage.\n     * It's typically between 0.2% and 2% of the mortgage principal.\n     */\n    get pmiCost() {\n        const lessThanTwentyPercent = (this.downpayment / this.price) < 0.2;\n        return lessThanTwentyPercent\n            ? ((this.pmi / 100) * this.mortgagePrincipal) / 12\n            : 0;\n    }\n\n    /**\n     * Property tax is a percentage of the price\n     * split into 12 month payments\n     */\n    get taxesCost() {\n        return ((this.taxes / 100) * this.price) / 12;\n    }\n\n    /**\n     * Home insurance is a percentage of the price\n     * split into 12 month payments\n     * @returns {Number}\n     */\n    get insuranceCost() {\n        const insuranceCost = ((this.insurance / 100) * this.price) / 12;\n        return insuranceCost;\n    }\n\n    get feesCost() {\n        const feesCost = this.hoa;\n        return feesCost;\n    }\n\n    /**\n     * Monthly payment adds all the monthly costs up into a single sum\n     * @returns {Number}\n     */\n    get monthlyPayment() {\n        const monthlyPayment = this.monthlyPrincipalAndInterest + this.taxesCost + this.insuranceCost + this.pmiCost + this.feesCost;\n        return monthlyPayment;\n    }\n\n    generateChart() {\n        const chartContainer = this.shadowRoot.querySelector('.mortgage-calc__chart');\n        this.chartElement = document.createElement('chart-donut');\n        this.chartElement.colors = this.colors;\n        this.chartElement.labels = ['Principal + Interest', 'Taxes', 'Fees'];\n        this.chartElement.values = [this.monthlyPrincipalAndInterest, this.taxesCost, this.feesCost];\n\n        chartContainer.append(this.chartElement);\n    }\n\n    /**\n     * Handles input events for the mortgage calc form\n     */\n    handleInput() {\n        this.output.principal.textContent = this.currencyFormat(this.monthlyPrincipalAndInterest);\n        this.output.taxes.textContent = this.currencyFormat(this.taxesCost);\n        this.output.fees.textContent = this.currencyFormat(this.feesCost);\n        this.output.perMonth.textContent = this.currencyFormat(this.monthlyPayment);\n        if (this.chartElement) {\n            this.chartElement.values = [this.monthlyPrincipalAndInterest, this.taxesCost, this.feesCost];\n        }\n    }\n\n    connectedCallback() {\n        this.generateChart();\n    }\n\n    /**\n     * Handles changes to the component attributes\n     * @param {String} attr - The attribute that changed\n     * @param {*} oldVal - The old value\n     * @param {*} newVal - The new value\n     */\n    attributeChangedCallback(attr, oldVal, newVal) {\n        // Update attributes\n        if (attr === 'price') {\n            this.price = newVal;\n        } else if (attr === 'downpayment') {\n            this.downpayment = newVal;\n        } else if (attr === 'interest') {\n            this.interest = newVal;\n        } else if (attr === 'taxes') {\n            this.taxes = newVal;\n        } else if (attr === 'term') {\n            this.term = newVal;\n        } else if (attr === 'hoa') {\n            this.hoa = newVal;\n        }\n\n        // Update the outputs\n        this.output.principal.textContent = this.currencyFormat(this.monthlyMortgagePrincipal + this.monthlyInterestCost);\n        this.output.taxes.textContent = this.currencyFormat(this.taxesCost);\n        this.output.fees.textContent = this.currencyFormat(this.feesCost);\n        this.output.perMonth.textContent = this.currencyFormat(this.monthlyPayment);\n        if (this.chartElement) {\n            this.chartElement.values = [this.monthlyPrincipalAndInterest, this.taxesCost, this.feesCost];\n        }\n    }\n}\n\n// Define the component\nif (!window.customElements.get('mortgage-calc')) {\n    window.customElements.define('mortgage-calc', MortgageCalc);\n}\n"],"names":["MortgageCalc","HTMLElement","observedAttributes","constructor","super","el","document","createElement","innerHTML","this","attachShadow","mode","shadowRoot","appendChild","content","cloneNode","registerComponents","MortgageCalcInput","RadioGroup","ChartDonut","chartElement","undefined","elements","price","querySelector","downpayment","interest","taxes","term","hoa","output","principal","fees","perMonth","addEventListener","handleInput","colors","getAttribute","replace","JSON","parse","currencyFormat","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","numeric","v","value","pmi","insurance","mortgagePrincipal","monthlyInterestRate","numberOfPayments","monthlyPrincipalAndInterest","Math","pow","monthlyMortgagePrincipal","monthlyInterestCost","pmiCost","taxesCost","insuranceCost","feesCost","monthlyPayment","generateChart","chartContainer","labels","values","append","textContent","connectedCallback","attributeChangedCallback","attr","oldVal","newVal","window","customElements","get","define"],"mappings":"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"}