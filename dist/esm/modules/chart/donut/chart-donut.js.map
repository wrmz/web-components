{"version":3,"file":"chart-donut.js","sources":["../../../../../src/modules/chart/donut/chart-donut.js"],"sourcesContent":["// import { registerComponents  } from '../../common/register-components';\n\n/**\n * @injectHTML\n */\nexport class ChartDonut extends HTMLElement {\n    static get observedAttributes() {\n        return [\n            'colors',\n            'values',\n            'labels',\n        ];\n    }\n\n    static degreesToRadians(angle) {\n        return angle * (Math.PI / 180);\n    }\n\n    constructor() {\n        super();\n        this.gap = 2;\n        this.cx = 80;\n        this.cy = 80;\n        this.radius = 60;\n        this.angleOffset = -90;\n        this.chartData = [];\n        this.segmentElems = [];\n        this.isLoaded = false;\n\n        this.svg = this.shadowRoot.querySelector('svg');\n        this.generateSegment = this.generateSegment.bind(this);\n        this.updateSegment = this.updateSegment.bind(this);\n    }\n\n    get currencyFormat() {\n        return new Intl.NumberFormat('en-US', {\n            style: 'currency',\n            currency: 'USD',\n            minimumFractionDigits: 0,\n            maximumFractionDigits: 0,\n        }).format;\n    }\n\n    set colors(v) {\n        this.setAttribute('colors', JSON.stringify(v));\n    }\n\n    get colors() {\n        const colors = (this.getAttribute('colors') || '').replace(/'/g, '\"');\n        return colors ? JSON.parse(colors) : ['red', 'green', 'blue'];\n    }\n\n    set labels(v) {\n        this.setAttribute('labels', JSON.stringify(v));\n    }\n\n    get labels() {\n        const labels = (this.getAttribute('labels') || '').replace(/'/g, '\"');\n        return labels ? JSON.parse(labels) : [];\n    }\n\n    set values(v) {\n        this.setAttribute('values', JSON.stringify(v));\n    }\n\n    get values() {\n        const values = (this.getAttribute('values') || '').replace(/'/g, '\"');\n        return values ? JSON.parse(values) : [];\n    }\n\n    get total() {\n        return this.values.length\n            ? this.values.reduce((previous, current) => previous + current)\n            : 0;\n    }\n\n    get circumference() {\n        return 2 * Math.PI * this.radius;\n    }\n\n    get adjustedCircumference() {\n        return this.circumference - this.gap;\n    }\n\n    /**\n     * Loops through the values and generates a segment for each\n     */\n    generateSegments() {\n        this.values.forEach(this.generateSegment);\n    }\n\n    /**\n     * Generates an individual segment\n     * @param {number} val - The amount this segmenet represents\n     * @param {number} i - Index of this value in `this.values`\n     */\n    generateSegment(val, i) {\n        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');\n        const data = {\n            degrees: this.angleOffset,\n        };\n\n        this.angleOffset += this.dataPercentage(this.values[i]) * 360;\n        this.chartData.push(data);\n\n        circle.setAttribute('tabindex', '0');\n        circle.setAttribute('cx', this.cx);\n        circle.setAttribute('cy', this.cy);\n        circle.setAttribute('r', this.radius);\n        circle.setAttribute('fill', 'transparent');\n        circle.setAttribute('stroke', this.colors[i]);\n        circle.setAttribute('stroke-width', 30);\n        circle.setAttribute('stroke-dasharray', this.adjustedCircumference);\n        circle.setAttribute('stroke-dashoffset', this.calculateStrokeDashOffset(this.values[i]));\n        circle.setAttribute('transform', this.calculateTransform(i));\n        circle.appendChild(title);\n        title.textContent = `${this.labels[i]}: ${this.currencyFormat(val)}`;\n\n        this.segmentElems.push(circle);\n        this.svg.appendChild(circle);\n    }\n\n    updateSegments() {\n        this.angleOffset = -90;\n        this.chartData = [];\n        this.values.forEach(this.updateSegment);\n    }\n\n    updateSegment(val, i) {\n        const circle = this.segmentElems[i];\n        const title = circle.querySelector('title');\n        const data = {\n            degrees: this.angleOffset,\n        };\n\n        this.angleOffset += this.dataPercentage(this.values[i]) * 360;\n        this.chartData.push(data);\n\n        title.textContent = `${this.labels[i]}: ${this.currencyFormat(val)}`;\n        circle.setAttribute('stroke-dasharray', this.adjustedCircumference);\n        circle.setAttribute('stroke-dashoffset', this.calculateStrokeDashOffset(this.values[i]));\n        circle.setAttribute('transform', this.calculateTransform(i));\n    }\n\n    calculateStrokeDashOffset(val) {\n        const strokeDiff = this.dataPercentage(val) * this.circumference;\n        return this.circumference - strokeDiff;\n    }\n\n    /**\n     * Calculates the transform rotation the circle should be\n     * attributed with\n     * @param {Number} i - The index of chart data to use\n     * @returns {String} - The rotation of the circle\n     */\n    calculateTransform(i) {\n        return `rotate(${this.chartData[i].degrees}, ${this.cx}, ${this.cy})`;\n    }\n\n    /**\n     * Gets the percentage a given value represents of the total\n     * @param {Number} val - The divisor\n     * @returns {Number} - The percentage\n     */\n    dataPercentage(val) {\n        return (this.total && val) ? val / this.total : 0;\n    }\n\n    /**\n     * Destroys the segments of the circle by removing the elements,\n     * removing them from the `segmentElems` array and removing their\n     * data from the `segmentElems` array.\n     */\n    destroySegments() {\n        while (this.svg.firstChild) {\n            this.svg.removeChild(this.svg.firstChild);\n            this.segmentElems.shift();\n            this.chartData.shift();\n        }\n        this.angleOffset = -90;\n    }\n\n    connectedCallback() {\n        this.generateSegments();\n        this.isLoaded = true;\n    }\n\n    /**\n     * @param {string} attr - The attribute which changed\n     * @param {string} oldVal - The old value\n     * @param {string} newVal - The new value\n     */\n    attributeChangedCallback() {\n        if (this.isLoaded && this.colors && this.values && this.total) {\n            this.updateSegments();\n        }\n    }\n}\n\nif (!window.customElements.get('chart-donut')) {\n    window.customElements.define('chart-donut', ChartDonut);\n}\n"],"names":["ChartDonut","HTMLElement","observedAttributes","static","angle","Math","PI","constructor","super","this","attachShadow","mode","innerHTML","gap","cx","cy","radius","angleOffset","chartData","segmentElems","isLoaded","svg","shadowRoot","querySelector","generateSegment","bind","updateSegment","currencyFormat","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","colors","v","setAttribute","JSON","stringify","getAttribute","replace","parse","labels","values","total","length","reduce","previous","current","circumference","adjustedCircumference","generateSegments","forEach","val","i","circle","document","createElementNS","title","data","degrees","dataPercentage","push","calculateStrokeDashOffset","calculateTransform","appendChild","textContent","updateSegments","strokeDiff","destroySegments","firstChild","removeChild","shift","connectedCallback","attributeChangedCallback","window","customElements","get","define"],"mappings":"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"}