{"version":3,"file":"gl-google-map.js","sources":["../../../../../src/modules/map/gl-google-map/gl-google-map.js"],"sourcesContent":["/*global google*/\nimport { registerComponents } from '../../common/register-components.js';\nimport { GlGoogleMarker } from '../gl-google-marker/gl-google-marker.js';\n\n/**\n * @injectHTML\n */\nexport class GlGoogleMap extends HTMLElement {\n    static get observedAttributes() {\n        return [\n            'key',\n            'latitude',\n            'longitude',\n        ];\n    }\n\n    constructor(args) {\n        super();\n\n        registerComponents(GlGoogleMarker);\n\n        this.key = '';\n        this._id = crypto.randomUUID ? crypto.randomUUID().split('-').pop() : Math.round(Math.random() * 9999);\n        this._markerElems = this.querySelectorAll('gl-google-marker');\n        this._markers = [];\n        this.apiLoadedCBName = `gl_cb_${this._id}`;\n        this.map = undefined;\n        this.elem = this.shadowRoot.querySelector('.map');\n        this.elem.setAttribute('id', `map_${this._id}`);\n\n        this.generateMarker = this.generateMarker.bind(this);\n    }\n\n    get latitude() {\n        const latitude = parseFloat(this.hasAttribute('latitude') ? this.getAttribute('latitude') : '0');\n        return  isNaN(latitude) ? 0 : latitude;\n    }\n\n    get longitude() {\n        const longitude = parseFloat(this.hasAttribute('longitude') ? this.getAttribute('longitude') : '0');\n        return  isNaN(longitude) ? 0 : longitude;\n    }\n\n    get markerElems() {\n        return [...this._markerElems];\n    }\n\n    get markers() {\n        return this._markers;\n    }\n\n    set markers(markers) {\n        if (this.map && google && google.maps) {\n            this._markers = markers.map(this.generateMarker);\n        } else {\n            this._markers = [];\n        }\n    }\n\n    handleApiLoaded() {\n        this.map = new google.maps.Map(this.elem, {\n            center: { lat: this.latitude, lng: this.longitude },\n            zoom: 8\n        });\n        this.markers = this.markerElems;\n    }\n\n    generateMarker(marker) {\n        const mapMarker = new google.maps.Marker({\n            map: this.map,\n            position: { lat: marker.latitude, lng: marker.longitude },\n            draggable: true,\n        });\n\n        mapMarker.addListener('dragend', (event) => {\n            const dragendEvent = new Event('dragend', {\n                detail: {\n                    map: this.map,\n                    marker: mapMarker,\n                    position: {\n                        latitude: event.latLng.lat(),\n                        longitude: event.latLng.lng()\n                    }\n                }\n            });\n            this.dispatchEvent(dragendEvent);\n        });\n\n        return mapMarker;\n    }\n\n    loadGoogleMapsApi() {\n        console.log('loading api');\n        const endpoint = 'https://maps.googleapis.com/maps/api/js';\n        const script = document.createElement('script');\n        script.id = `map_script_${this._id}`;\n        script.type = 'text/javascript';\n        script.src = `${endpoint}?key=${this.key}&callback=${this.apiLoadedCBName}&v=weekly`;\n        script.defer = true;\n        script.async = true;\n        window[this.apiLoadedCBName] = this.handleApiLoaded.bind(this);\n        document.head.appendChild(script);\n    }\n\n    /**\n     * Fires when the component is connected to the DOM\n     */\n    connectedCallback() {\n        console.log('connected');\n    }\n\n    /**\n     * Handles changes to the component attributes\n     * @param {String} name\n     * @param {String} oldValue\n     * @param {String} newValue\n     */\n    attributeChangedCallback(name, oldValue, newValue) {\n        if (name === 'key' && newValue) {\n            this.key = newValue;\n            this.removeAttribute('key');\n            this.loadGoogleMapsApi();\n        }\n    }\n}\n\nif (!window.customElements.get('gl-google-map')) {\n    window.customElements.define('gl-google-map', GlGoogleMap);\n}\n"],"names":["GlGoogleMap","HTMLElement","observedAttributes","constructor","args","super","el","document","createElement","innerHTML","this","attachShadow","mode","shadowRoot","appendChild","content","cloneNode","registerComponents","GlGoogleMarker","key","_id","crypto","randomUUID","split","pop","Math","round","random","_markerElems","querySelectorAll","_markers","apiLoadedCBName","map","undefined","elem","querySelector","setAttribute","generateMarker","bind","latitude","parseFloat","hasAttribute","getAttribute","isNaN","longitude","markerElems","markers","google","maps","handleApiLoaded","Map","center","lat","lng","zoom","marker","mapMarker","Marker","position","draggable","addListener","event","dragendEvent","Event","detail","latLng","dispatchEvent","loadGoogleMapsApi","console","log","script","id","type","src","defer","async","window","head","connectedCallback","attributeChangedCallback","name","oldValue","newValue","removeAttribute","customElements","get","define"],"mappings":"kJAOO,MAAMA,oBAAoBC,YAClBC,gCACP,MAAO,CACH,MACA,WACA,YAEP,CAEDC,YAAYC,GACRC,QAAQ,MAAMC,EAAKC,SAASC,cAAc,YAAYF,EAAGG,UAAY,4KAA4KC,KAAKC,aAAa,CAACC,KAAK,SAASF,KAAKG,WAAWC,YAAYR,EAAGS,QAAQC,WAAU,IAEnUC,EAAmBC,GAEnBR,KAAKS,IAAM,GACXT,KAAKU,IAAMC,OAAOC,WAAaD,OAAOC,aAAaC,MAAM,KAAKC,MAAQC,KAAKC,MAAsB,KAAhBD,KAAKE,UACtFjB,KAAKkB,aAAelB,KAAKmB,iBAAiB,oBAC1CnB,KAAKoB,SAAW,GAChBpB,KAAKqB,gBAAkB,SAASrB,KAAKU,MACrCV,KAAKsB,SAAMC,EACXvB,KAAKwB,KAAOxB,KAAKG,WAAWsB,cAAc,QAC1CzB,KAAKwB,KAAKE,aAAa,KAAM,OAAO1B,KAAKU,OAEzCV,KAAK2B,eAAiB3B,KAAK2B,eAAeC,KAAK5B,KAClD,CAEG6B,eACA,MAAMA,EAAWC,WAAW9B,KAAK+B,aAAa,YAAc/B,KAAKgC,aAAa,YAAc,KAC5F,OAAQC,MAAMJ,GAAY,EAAIA,CACjC,CAEGK,gBACA,MAAMA,EAAYJ,WAAW9B,KAAK+B,aAAa,aAAe/B,KAAKgC,aAAa,aAAe,KAC/F,OAAQC,MAAMC,GAAa,EAAIA,CAClC,CAEGC,kBACA,MAAO,IAAInC,KAAKkB,aACnB,CAEGkB,cACA,OAAOpC,KAAKoB,QACf,CAEGgB,YAAQA,GACJpC,KAAKsB,KAAOe,QAAUA,OAAOC,KAC7BtC,KAAKoB,SAAWgB,EAAQd,IAAItB,KAAK2B,gBAEjC3B,KAAKoB,SAAW,EAEvB,CAEDmB,kBACIvC,KAAKsB,IAAM,IAAIe,OAAOC,KAAKE,IAAIxC,KAAKwB,KAAM,CACtCiB,OAAQ,CAAEC,IAAK1C,KAAK6B,SAAUc,IAAK3C,KAAKkC,WACxCU,KAAM,IAEV5C,KAAKoC,QAAUpC,KAAKmC,WACvB,CAEDR,eAAekB,GACX,MAAMC,EAAY,IAAIT,OAAOC,KAAKS,OAAO,CACrCzB,IAAKtB,KAAKsB,IACV0B,SAAU,CAAEN,IAAKG,EAAOhB,SAAUc,IAAKE,EAAOX,WAC9Ce,WAAW,IAiBf,OAdAH,EAAUI,YAAY,WAAYC,IAC9B,MAAMC,EAAe,IAAIC,MAAM,UAAW,CACtCC,OAAQ,CACJhC,IAAKtB,KAAKsB,IACVuB,OAAQC,EACRE,SAAU,CACNnB,SAAUsB,EAAMI,OAAOb,MACvBR,UAAWiB,EAAMI,OAAOZ,UAIpC3C,KAAKwD,cAAcJ,EAAa,IAG7BN,CACV,CAEDW,oBACIC,QAAQC,IAAI,eACZ,MACMC,EAAS/D,SAASC,cAAc,UACtC8D,EAAOC,GAAK,cAAc7D,KAAKU,MAC/BkD,EAAOE,KAAO,kBACdF,EAAOG,IAAM,+CAAmB/D,KAAKS,gBAAgBT,KAAKqB,2BAC1DuC,EAAOI,OAAQ,EACfJ,EAAOK,OAAQ,EACfC,OAAOlE,KAAKqB,iBAAmBrB,KAAKuC,gBAAgBX,KAAK5B,MACzDH,SAASsE,KAAK/D,YAAYwD,EAC7B,CAKDQ,oBACIV,QAAQC,IAAI,YACf,CAQDU,yBAAyBC,EAAMC,EAAUC,GACxB,QAATF,GAAkBE,IAClBxE,KAAKS,IAAM+D,EACXxE,KAAKyE,gBAAgB,OACrBzE,KAAKyD,oBAEZ,EAGAS,OAAOQ,eAAeC,IAAI,kBAC3BT,OAAOQ,eAAeE,OAAO,gBAAiBtF"}